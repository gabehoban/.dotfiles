#!/bin/sh

echo "---------------------------------------------------------"
echo "$(tput setaf 2)LIL-BAYMAX: Preparing to backup system and begin diagnostics.$(tput sgr 0)"
echo "---------------------------------------------------------"

sudo echo -n
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &
cd "$HOME/.dotfiles"

echo "---------------------------------------------------------"
echo "$(tput setaf 2)LIL-BAYMAX: Encrypting SSH Keys and saving.$(tput sgr 0)"
echo "---------------------------------------------------------"

rm -rdf "$HOME"/.dotfiles/gnupg/crypt/ssh.tar.gz.gpg
tar -czvf ssh.tar.gz "$HOME/.ssh"
gpg --encrypt --sign --armor -r hobang1@udayton.edu ssh.tar.gz
mv "$HOME"/.dotfiles/ssh.tar.gz.asc "$HOME"/.dotfiles/gnupg/crypt
rm -rdf ssh.tar.gz
echo -e "\\033[1;34m-> Done...\\033[0m"

echo "---------------------------------------------------------"
echo "$(tput setaf 2)LIL-BAYMAX: Updating brewfile.$(tput sgr 0)"
echo "---------------------------------------------------------"

upbrew
echo -e "\\033[1;34m-> Done...\\033[0m"


echo "---------------------------------------------------------"
echo "$(tput setaf 2)LIL-BAYMAX: Pushing with Git.$(tput sgr 0)"
echo "---------------------------------------------------------"

cd "$HOME/.dotfiles"
git add -A && git commit -m "sync" && git push origin master

echo "───▄▀▀▀▄▄▄▄▄▄▄▀▀▀▄───"
echo "───█▒▒░░░░░░░░░▒▒█───   DOTFILES"
echo "────█░░█░░░░░█░░█────     UPDATED..."
echo "─▄▄──█░░░▀█▀░░░█──▄▄─"
echo "█░░█─▀▄░░░░░░░▄▀─█░░█"
